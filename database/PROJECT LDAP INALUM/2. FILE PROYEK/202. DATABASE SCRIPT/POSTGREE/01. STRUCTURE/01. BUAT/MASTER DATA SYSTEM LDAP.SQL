DROP SCHEMA IF EXISTS SYSTEM CASCADE;
CREATE SCHEMA SYSTEM;

DROP TYPE IF EXISTS SYSTEM.STATUS;
CREATE TYPE IF NOT EXISTS SYSTEM.STATUS AS ENUM('A','N');

/**
* Nomor : 1 
*/
CREATE TABLE SYSTEM.MD_ROLE_SYSTEM(
    KD_ROLE_SYSTEM	VARCHAR	(10),
	NM_ROLE_SYSTEM	VARCHAR	(100),
	STATUS			STATUS DEFAULT 'A',
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY (KD_ROLE_SYSTEM)
);

/**
* Nomor : 2 
*/	
CREATE TABLE SYSTEM.MD_USER_SYSTEM(
    UID_USER_SYSTEM	VARCHAR	(30),
	USERNAME		VARCHAR	(100),
	EMAIL			VARCHAR	(100),
	PASSWORD		VARCHAR	(50),
	NAMA			VARCHAR	(250),
	KD_ROLE_SYSTEM	VARCHAR	(10),
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(UID_USER_SYSTEM),
    CONSTRAINT FK_KD_ROLE_SYS_MD_USER_SYS FOREIGN KEY (KD_ROLE_SYSTEM) REFERENCES MD_ROLE_SYSTEM(KD_ROLE_SYSTEM) ON UPDATE CASCADE ON DELETE RESTRICT
);

/**
* Nomor : 3 
*/	
CREATE TABLE SYSTEM.D_APPLICATION(
    APP_KEY			VARCHAR	(50),
	UID_USER_SYSTEM	VARCHAR	(30),
	DOMAIN			VARCHAR	(100),
	IS_EXPIRED		BOOLEAN,
	TGL_EXPIRED		TIMESTAMP,
	STATUS			STATUS DEFAULT 'A',
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(APP_KEY),
    CONSTRAINT FK_UID_USER_SYS_D_APP FOREIGN KEY (UID_USER_SYSTEM) REFERENCES MD_USER_SYSTEM(UID_USER_SYSTEM) ON UPDATE CASCADE ON DELETE RESTRICT
);

/**
* Nomor : 4 
*/	
CREATE TABLE SYSTEM.MD_METHOD(
    KD_METHOD		VARCHAR	(10),
	NM_METHOD		VARCHAR	(10),
	STATUS			STATUS DEFAULT 'A',
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(KD_METHOD)
);

/**
* Nomor : 5 
*/
CREATE TABLE SYSTEM.MD_API_GROUP(
    KD_API_GROUP	VARCHAR	(100),
	NM_API_GROUP	VARCHAR	(250),
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(KD_API_GROUP)
);

/**
* Nomor : 6 
*/
CREATE TABLE SYSTEM.MD_API(
    KD_API			VARCHAR	(50),
	LINK			VARCHAR	(500),
	DESKRIPSI		VARCHAR	(2000),
	KD_METHOD		VARCHAR	(10),
	KD_API_GROUP	VARCHAR	(100),
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(KD_API),
    CONSTRAINT FK_KD_METHOD_MD_API FOREIGN KEY (KD_METHOD) REFERENCES MD_METHOD(KD_METHOD),
    CONSTRAINT FK_KD_API_GROUP_MD_API FOREIGN KEY (KD_API_GROUP) REFERENCES MD_API_GROUP(KD_API_GROUP) ON UPDATE CASCADE ON DELETE RESTRICT
);

/**
* Nomor : 7 
*/
CREATE TABLE SYSTEM.D_APP_AKSES(
    KD_APP_AKSES	VARCHAR	(60),
	APP_KEY	        VARCHAR	(50),
	KD_API	        VARCHAR	(50),
	IS_EXPIRED	    BOOLEAN,
	TGL_EXPIRED	    TIMESTAMP,
	IS_DELETED 		BOOLEAN DEFAULT FALSE,

    PRIMARY KEY(KD_APP_AKSES),
    CONSTRAINT FK_APP_KEY_D_APP_AKSES FOREIGN KEY (APP_KEY) REFERENCES D_APPLICATION(APP_KEY) ON UPDATE CASCADE ON DELETE RESTRICT,
    CONSTRAINT FK_KD_API_D_APP_AKSES FOREIGN KEY (KD_API) REFERENCES MD_API(KD_API) ON UPDATE CASCADE ON DELETE RESTRICT
);