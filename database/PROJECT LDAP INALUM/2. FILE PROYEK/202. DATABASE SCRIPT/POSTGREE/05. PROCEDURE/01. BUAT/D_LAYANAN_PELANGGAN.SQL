CREATE OR REPLACE FUNCTION P_ISI_D_LAYANAN_PELANGGAN(
	KD_LAYANAN1 character varying,
	KD_PRODUK1 character varying,
	KD_PELANGGAN1 character varying,
	NM_PERUSAHAAN1 character varying,
	DESKRIPSI1 character varying,
	NOMINAL_TAGIHAN1 character varying,
	NM_PJ1 character varying,
	NO_HP_PJ1 character varying,
	ALAMAT_PJ1 character varying,
	EMAIL_PJ1 character varying
)
RETURNS character varying AS 
$BODY$
DECLARE 
	CACAH NUMERIC;

BEGIN
	SELECT COUNT(*) INTO CACAH FROM D_LAYANAN_PELANGGAN WHERE KD_LAYANAN = KD_LAYANAN1;
	IF CACAH > 0 THEN
		UPDATE D_LAYANAN_PELANGGAN SET KD_PRODUK = KD_PRODUK1, KD_PELANGGAN = KD_PELANGGAN1, NM_PERUSAHAAN = NM_PERUSAHAAN1, DESKRIPSI = DESKRIPSI1, NOMINAL_TAGIHAN = NOMINAL_TAGIHAN1, NM_PJ = NM_PJ1, NO_HP_PJ = NO_HP_PJ1, ALAMAT_PJ = ALAMAT_PJ1, EMAIL_PJ = EMAIL_PJ1 WHERE KD_LAYANAN = KD_LAYANAN1;
	ELSE
		INSERT INTO D_LAYANAN_PELANGGAN (KD_LAYANAN, KD_PRODUK, KD_PELANGGAN, NM_PERUSAHAAN, DESKRIPSI, NOMINAL_TAGIHAN, NM_PJ, NO_HP_PJ, ALAMAT_PJ, EMAIL_PJ) VALUES (KD_LAYANAN1, KD_PRODUK1, KD_PELANGGAN1, NM_PERUSAHAAN1, DESKRIPSI1, NOMINAL_TAGIHAN1, NM_PJ1, NO_HP_PJ1, ALAMAT_PJ1, EMAIL_PJ1);
	END IF;

	RETURN 'OKE';
END;
$BODY$
	LANGUAGE plpgsql VOLATILE;

-- DELETE
CREATE OR REPLACE FUNCTION P_DEL_D_LAYANAN_PELANGGAN(
	KD_LAYANAN1 character varying
)
RETURNS character varying AS 
$BODY$
DECLARE 
	CACAH NUMERIC;
	ERR_MSG VARCHAR;
BEGIN
	SELECT COUNT(*) INTO CACAH FROM D_LAYANAN_PELANGGAN WHERE KD_LAYANAN = KD_LAYANAN1;
	IF CACAH > 0 THEN
		DELETE FROM D_LAYANAN_PELANGGAN WHERE KD_LAYANAN = KD_LAYANAN1;
		ERR_MSG := 'OKE';
	ELSE
		ERR_MSG := 'GAGAL';
	END IF;

	RETURN ERR_MSG;
END;
$BODY$
	LANGUAGE plpgsql VOLATILE;